# CFS App in Rust
<<<<<<< HEAD
This crate provides bindings to the NASA [Core Flight Executive
(CFE)](https://github.com/nasa/cFE) and [Operational System Abstraction Layer
(OSAL)](https://github.com/nasa/osal). These provide a core set of
software components for building flight software systems, as well
as a mechanism to extend the system with additional modules called 
Core Flight Software (CFS) Apps. With the cfs-sys crate, you can write your CFS Apps in
Rust!


This is the base bindings generated by bindgen. A Rusty interface could be written
to wrap up all the unsafe FFI called and raw pointers.


## Building
This crate is intended to be used as a dependancy of a CFS App written in Rust.
There is an example of such an app at: 


This project has been tested with the i686-unknown-linux-gnu target
by building the POSIX implementation of OSAL.
=======
This project is a prototype CFS application written in Rust.


The best case here is that this turns into a way to create new
CFS Apps in Rust, taking care of the boilerplate, the binding
generation, and integration with the CFS system.


## Building
This project has been tested with the i686-unknown-linux-gnu target
by building the POSIX version of OSAL.
>>>>>>> be19f9f8f42ef8ec63ab56f0f1fc2f5676aa54e7


To get this target using rustup, type
```shell
rustup target add i686-unknown-linux-gnu
```

<<<<<<< HEAD
To build this project, you need the following environment variables defined:


* OSAL\_DIR
* PSP\_DIR
* CFE\_FSW
* CFE\_CORE\_SRC
* CFS\_MISSION
* CFS\_MISSION\_INC


The easiest way to define these is to clone the 
[cFE github repository](https://github.com/nasa/cFE) and its submodules
(at least OSAL- the submodules in the app directory are not necessary).


Then go to your cloned cFE repository, and type the following to set up
the necessary environment variables:


```shell
. ./setvars.sh
```
=======
This project also currently assumes you have the CFE repo as a submodule.
>>>>>>> be19f9f8f42ef8ec63ab56f0f1fc2f5676aa54e7


##The Concept
This library is build using a build.rs file which uses bindgen to generate
binding to all of the OSAL, PSP, and CFE includes you would need to write
a CFE application.


Since each CFS project may be different, the bindings should really be
generated each time as part of the build process. In principal, however,
we could build bindings to a generic CFS project. This may require
assuming an operating system, or having a separate set of bindings, one
for each operating system. Even then, any changes to the PSP or mission
specific configuration would require regenerating the bindings, so this
may not be a good idea.



The library is configured to build a shared library, which in principal can
be loaded by CFE as a CFS application. This is yet to be seen.

<<<<<<< HEAD

## Note on Shared Object Size
When using the cfs-sys crate to write a CFS App, I've noticed that
I get a .so file 3MB by default, with lto=true and panic='abort'. Stripping
this gets down to about 200KOB.


For reference, other CFS apps are 8KB to 20KB or so. This works fine for
some environments, but in space it would be nice to have small object files to
assist in uploading new code through a slow, intermittent connection.


Compression with xz gets this down to 79KB, which is better, but still not
great.
=======
## Enhancements
It would be better to allow the user to point to a CFS project, and build
bindings from that. If the app is integrated into the CFS project, the
environmental variables should be able to cover that.


There might be a way to integrate with CFS so that the app is built with the
makefile system and gets packaged up just like a normal application.
In this case the user simply needs cargo installed, and the correct toolchain.
This may allow the correct OS bindings in OSAL and PSP when doing binding
generation to make this a more general solution.


This may end up as a template for writing CFS apps, where you essentially clone the
app, or there is a builder that outputs an app of a particular name, and you
include it in your project as usual.


## Notes
About 5MB by default, with or without lto=true.


Gets down to 2MB with strip.


Other CFS apps are 8KB to 20KB or so.
>>>>>>> be19f9f8f42ef8ec63ab56f0f1fc2f5676aa54e7

## Macros in CFS
There are macros with arguments (aka inline functions) used in certain CFE modules.
There are listed below:
* ccsds.h
* cfs\_es.h
* cfs\_evs.h
* cfs\_tbl\_filedef.h
* cfs\_sb.h
* common\_types.h
* cfe\_platform\_cfg.h
* cfe\_psp\_module.h
 
